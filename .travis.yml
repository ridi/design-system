language: node_js
node_js: '10'
cache: yarn

script:
  - yarn build

before_deploy:
  - git config --global user.email "travis@travis-ci.com"
  - git config --global user.name "Travis CI"
  - printf "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" >> ~/.npmrc

deploy:
  - provider: script
    name: website
    script: node ./deploy-website.js
    skip_cleanup: true
    on:
      repo: ridi/design-system
      all_branches: true

  - provider: script
    name: package-explorer
    script: node ./deploy-package-explorer.js
    skip_cleanup: true
    on:
      repo: ridi/design-system
      all_branches: true

  - provider: script
    name: npm
    script: lerna publish from-git --yes
    skip_cleanup: true
    on:
      repo: ridi/design-system
      branch: master
      tags: true
